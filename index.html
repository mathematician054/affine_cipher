<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Affine Cipher</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    textarea, input { width: 100%; margin-top: 5px; margin-bottom: 15px; padding: 8px; }
    button { padding: 10px 20px; margin: 5px 5px 15px 0; }
    .output { background: #fff; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; }
    .section { margin-bottom: 30px; }
    #visualSection { 
      display: none; 
      transition: all 0.3s ease;
    }
  </style>
</head>
<body>

<h1>🔐 Affine Cipher</h1>

<div class="section">
  <label for="plaintext">Teks:</label>
  <textarea id="plaintext" rows="4">HaloDunia</textarea>

  <label for="a">Kunci a (relatif prima dengan 26):</label>
  <input type="number" id="a" value="5">

  <label for="b">Kunci b:</label>
  <input type="number" id="b" value="8">

  <button onclick="encryptAffine()">Enkripsi</button>
  <button onclick="decryptAffine()">Dekripsi</button>
  <button id="toggleBtn" onclick="toggleVisualization()">🔍 Tampilkan Visualisasi</button>
</div>

<div class="section">
  <h3>📤 Hasil:</h3>
  <div class="output" id="ciphertext"></div>
</div>

<div class="section" id="visualSection">
  <h3>🔍 Visualisasi Proses:</h3>
  <div class="output" id="visualization"></div>
</div>

<script>
function modInverse(a, m) {
  a = ((a % m) + m) % m;
  for (let x = 1; x < m; x++) {
    if ((a * x) % m === 1) return x;
  }
  return null;
}

function affineShift(ch, a, b, encrypt = true) {
  const isUpper = ch >= 'A' && ch <= 'Z';
  const isLower = ch >= 'a' && ch <= 'z';
  if (!isUpper && !isLower) return { ch, info: `${ch} (non-huruf)` };

  const base = isUpper ? 65 : 97;
  const index = ch.charCodeAt(0) - base;
  let shifted, result, info;

  if (encrypt) {
    shifted = (a * index + b) % 26;
    result = String.fromCharCode(base + shifted);
    info = `${ch} → ${index}; E(x) = (${a}×${index} + ${b}) mod 26 = ${shifted} → ${result}`;
  } else {
    const a_inv = modInverse(a, 26);
    if (a_inv === null) return { ch, info: `❌ a=${a} tidak punya invers mod 26` };
    shifted = (a_inv * (index - b + 26)) % 26;
    result = String.fromCharCode(base + shifted);
    info = `${ch} → ${index}; D(y) = ${a_inv}×(${index} - ${b}) mod 26 = ${shifted} → ${result}`;
  }

  return { ch: result, info };
}

function processAffine(encrypt = true) {
  const text = document.getElementById("plaintext").value;
  const a = parseInt(document.getElementById("a").value);
  const b = parseInt(document.getElementById("b").value);
  const results = [];
  const visuals = [];

  for (let ch of text) {
    const { ch: outCh, info } = affineShift(ch, a, b, encrypt);
    results.push(outCh);
    visuals.push(info);
  }

  document.getElementById("ciphertext").textContent = results.join("");
  document.getElementById("visualization").textContent = visuals.join("\n");
}

function encryptAffine() {
  processAffine(true);
}

function decryptAffine() {
  processAffine(false);
}

function toggleVisualization() {
  const visual = document.getElementById("visualSection");
  const toggleBtn = document.getElementById("toggleBtn");
  const currentDisplay = getComputedStyle(visual).display;

  if (currentDisplay === "none") {
    visual.style.display = "block";
    toggleBtn.textContent = "🙈 Sembunyikan Visualisasi";
  } else {
    visual.style.display = "none";
    toggleBtn.textContent = "🔍 Tampilkan Visualisasi";
  }
}
</script>

</body>
</html>
