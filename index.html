<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Affine Cipher</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
    }
    .buttons {
      display: flex;
      gap: 4%;
      margin-top: 5px;
    }
    .buttons button {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }
    .toggle-btn {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
      width: 100%;
    }
    .output {
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .step-line {
      background: #fff;
      padding: 8px;
      border: 1px solid #ccc;
      margin-bottom: 4px;
      font-family: monospace;
    }
    #langkah-container {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>üîê Simulasi Affine Cipher</h1>

  <label for="text">Teks:</label>
  <textarea id="text" rows="4">Halo Dunia!</textarea>

  <label for="a">Kunci a (harus relatif prima dengan 26):</label>
  <input type="number" id="a" value="5" />

  <label for="b">Kunci b:</label>
  <input type="number" id="b" value="8" />

  <div class="buttons">
    <button onclick="prosesAffine(true)">üîê Enkripsi</button>
    <button onclick="prosesAffine(false)">üîì Dekripsi</button>
  </div>

  <button class="toggle-btn" id="toggleButton" onclick="toggleLangkah()">üîç Tampilkan Visualisasi</button>

  <h3>Hasil:</h3>
  <div class="output" id="hasil"></div>

  <div id="langkah-container">
    <h3>Visualisasi:</h3>
    <div id="langkah"></div>
  </div>

  <script>
    function gcd(a, b) {
      while (b !== 0) [a, b] = [b, a % b];
      return a;
    }

    function modInverse(a, m) {
      a = ((a % m) + m) % m;
      for (let x = 1; x < m; x++) {
        if ((a * x) % m === 1) return x;
      }
      return null;
    }

    function isLetter(c) {
      return /^[a-zA-Z]$/.test(c);
    }

    function prosesAffine(encrypt = true) {
      const text = document.getElementById("text").value;
      const a = parseInt(document.getElementById("a").value);
      const b = parseInt(document.getElementById("b").value);
      const hasilDiv = document.getElementById("hasil");
      const langkahDiv = document.getElementById("langkah");

      hasilDiv.textContent = "";
      langkahDiv.innerHTML = "";

      if (gcd(a, 26) !== 1) {
        alert("‚ùå Nilai a harus relatif prima dengan 26. Gunakan: 1, 3, 5, 7, 9, 11, 15, 17, 19, 21, 23, 25.");
        return;
      }

      const a_inv = encrypt ? null : modInverse(a, 26);
      if (!encrypt && a_inv === null) {
        alert("‚ùå Tidak ada invers dari a dalam mod 26.");
        return;
      }

      let hasil = "";

      for (let i = 0; i < text.length; i++) {
        const char = text[i];

        if (!isLetter(char)) {
          hasil += char;
          langkahDiv.innerHTML += `<div class="step-line">${char} (non-huruf) ‚Üí ${char}</div>`;
          continue;
        }

        const isUpper = char === char.toUpperCase();
        const base = isUpper ? 65 : 97;
        const index = char.charCodeAt(0) - base;
        let shifted, newChar, stepText;

        if (encrypt) {
          shifted = (a * index + b) % 26;
          newChar = String.fromCharCode(base + shifted);
          stepText = `${char} ‚Üí ${index}; E(x) = (${a}√ó${index} + ${b}) mod 26 = ${shifted} ‚Üí ${newChar}`;
        } else {
          shifted = (a_inv * ((index - b + 26) % 26)) % 26;
          newChar = String.fromCharCode(base + shifted);
          stepText = `${char} ‚Üí ${index}; D(x) = ${a_inv}√ó(${index} - ${b}) mod 26 = ${shifted} ‚Üí ${newChar}`;
        }

        hasil += newChar;
        langkahDiv.innerHTML += `<div class="step-line">${stepText}</div>`;
      }

      hasilDiv.textContent = hasil;
      // Reset visualisasi tersembunyi setiap kali proses baru
      document.getElementById("langkah-container").style.display = "none";
      document.getElementById("toggleButton").textContent = "üîç Tampilkan Visualisasi";
    }

    function toggleLangkah() {
      const container = document.getElementById("langkah-container");
      const toggleBtn = document.getElementById("toggleButton");

      const isHidden = container.style.display === "none";
      container.style.display = isHidden ? "block" : "none";
      toggleBtn.textContent = isHidden ? "‚ùå Sembunyikan Visualisasi" : "üîç Tampilkan Visualisasi";
    }
  </script>
</body>
</html>
